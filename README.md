# Team Sheet Bot - Telegram бот для записи на футбольные игры

Telegram бот для организации записи на футбольные игры в группе. Позволяет администратору создавать опросы для записи, а участникам - записываться на игры и записывать друзей.

## Возможности

- ✅ Создание записи на игру администратором
- ✅ Настройка количества мест (по умолчанию 10)
- ✅ Запись участников с автоматическим переходом в резерв при заполнении
- ✅ Управление списком друзей (добавление/удаление)
- ✅ Отображение друзей в сообщении игры
- ✅ Отмена записи с автоматическим перемещением из резерва
- ✅ Красивый UI с кнопками и статистикой
- ✅ Работа без базы данных (все данные в памяти)
- ✅ Восстановление состояния из текста сообщения при перезагрузке сервера

## Установка и настройка

### 1. Клонирование и установка зависимостей

```bash
git clone <repository-url>
cd team-sheet-bot
npm install
```

### 2. Создание бота в Telegram

1. Найдите [@BotFather](https://t.me/BotFather) в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Сохраните полученный токен

### 3. Получение ID администратора

1. Найдите [@userinfobot](https://t.me/userinfobot) в Telegram
2. Отправьте любое сообщение
3. Бот покажет ваш ID - сохраните его

### 4. Получение ID группы (опционально)

1. Добавьте бота в группу
2. Отправьте в группу команду `/start`
3. Перейдите по ссылке: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
4. Найдите `"chat":{"id": -1001234567890}` - это ID группы

### 5. Настройка переменных окружения

Скопируйте файл `env.example` в `.env` и заполните:

```env
BOT_TOKEN=your_bot_token_here
ADMIN_ID=your_telegram_id_here
GROUP_ID=your_group_id_here
```

### 6. Запуск бота

```bash
# Для разработки
npm run dev

# Для продакшена
npm start
```

## Использование

### Для администратора:

1. **Создание игры**: Отправьте `/start <количество> <описание>` в группе
2. **Пример**: `/start 10 Футбол в 18:00`
3. **Управление**: Бот автоматически создаст сообщение с кнопками для записи
4. **Завершение**: Отправьте `/end_game` для закрытия записи

### Для участников:

1. **Запись**: Нажмите кнопку "✅ Записаться"
2. **Отмена**: Нажмите "❌ Отменить запись"
3. **Резерв**: При заполнении мест появится кнопка "⏳ Записаться в резерв"

**Примечание**: 
- Игроки в резерве отображаются с эмодзи ⏳ без дополнительных слов
- Список игроков отображается в нумерованном формате (1., 2., 3., ...)
- Пустые места показываются как "4.", "5." и т.д.
- Блок статистики убран для более чистого отображения

### Управление друзьями:

1. **Добавить друга**: Отправьте `+ Имя` (например: `+ Иван`)
2. **Удалить друга**: Отправьте `- Имя` (например: `- Иван`)
3. **Посмотреть список**: Отправьте `/friends`
4. **Автоматическое обновление**: После добавления/удаления друга автоматически отправляется новое сообщение с обновленным списком

## Структура проекта

```
team-sheet-bot/
├── src/
│   ├── index.js          # Основной файл бота
│   ├── GameSession.js    # Класс для управления данными игры
│   └── handlers.js       # Обработчики команд и сообщений
├── package.json
├── env.example
├── README.md
└── RESTORE_STATE.md      # Документация по восстановлению состояния
```

## Восстановление состояния

При перезагрузке сервера состояние игры теряется. Для восстановления состояния используйте:

- **Автоматическое восстановление**: Просто нажмите на кнопки в существующем сообщении
- **Ручное восстановление**: Используйте команду `/restore_state` и отправьте текст сообщения

Подробная документация: [RESTORE_STATE.md](RESTORE_STATE.md)

## Особенности

- **Без базы данных**: Все данные хранятся в памяти и сбрасываются при перезапуске
- **Одно сообщение**: Бот редактирует одно сообщение вместо создания новых
- **Автоматический резерв**: При отмене записи первый из резерва автоматически переходит в основные игроки
- **Ограничения**: Обычные пользователи могут записать максимум 2 друзей, админ - неограниченно
- **Безопасность**: Бот работает только в указанной группе (если настроено)
- **Восстановление состояния**: При перезагрузке сервера состояние можно восстановить из текста основного сообщения
- **Сохранение userId**: В сообщениях отображаются реальные Telegram ID пользователей для корректного восстановления

## Команды

- `/start` - Начальная настройка или создание игры (для админа)
- `/friends` - Просмотр списка друзей
- `/end_game` - Завершение активной игры (только для админа)
- `/restore_state` - Восстановление состояния из текста сообщения (только для админа)

## Требования

- Node.js 14+
- npm или yarn
- Telegram аккаунт
- Доступ к группе в Telegram

## Лицензия

MIT
